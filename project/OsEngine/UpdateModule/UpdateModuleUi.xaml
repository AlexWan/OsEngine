<Window x:Class="OsEngine.UpdateModule.UpdateModuleUi"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:OsEngine.UpdateModule"
        mc:Ignorable="d"
        Title="Update module" Height="800" Width="700" 
        Style="{StaticResource WindowStyleCanResize}" 
        WindowStartupLocation="CenterScreen" 
        MinWidth="500" MinHeight="700" 
        Icon="/Images/OsLogo.ico">

    <Grid>
        <Grid.RowDefinitions>
            <!-- 2/3 высоты для TabControl -->
            <RowDefinition Height="2*" MinHeight="250"/>
            <!-- 1/3 высоты для лога -->
            <RowDefinition Height="*" MinHeight="150"/>
        </Grid.RowDefinitions>

        <!-- Верхняя область с TabControl -->
        <Grid Grid.Row="0" Name="UpdateInfoHost" Margin="5">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Кнопка запроса статуса обновлений -->
            <Grid Grid.Row="0" Margin="0,0,0,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Button Name="ButtonUpdRequest" 
                        Content="Запросить статус обновлений" 
                        Width="200" Height="35" 
                        HorizontalAlignment="Right"
                        Margin="0,0,0,0"
                        Click="ButtonUpdRequest_Click"/>
            </Grid>

            <!-- TabControl -->
            <TabControl Grid.Row="1" Name="TabControlPrime" BorderThickness="0">
                <TabItem Name="TabFiles" Header="Обновление" Width="140">
                    <Grid Margin="0,0,-5,0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Label Name="LabelFiles" 
                               Content="Файлы нуждающиеся в обновлении" 
                               HorizontalAlignment="Left" 
                               VerticalAlignment="Top" 
                               Margin="10,6,0,0" 
                               FontSize="12"/>

                        <DataGrid Name="FilesDataGrid" 
                                  Grid.Row="1"
                                  AutoGenerateColumns="False" 
                                  CanUserAddRows="False"
                                  IsReadOnly="True"
                                  Margin="0,5,0,5"
                                  Style="{StaticResource DataGridStyle}">

                            <DataGrid.Columns>

                                <DataGridTextColumn Header="Имя файла" Width="*" Binding="{Binding Name}">

                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding State}" Value="Removed">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding State}" Value="Obsolete">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding State}" Value="New">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>

                                </DataGridTextColumn>

                                <DataGridTextColumn Header="Размер" Width="80" Binding="{Binding Size}">

                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding State}" Value="Removed">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding State}" Value="Obsolete">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding State}" Value="New">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>

                                </DataGridTextColumn>

                                <DataGridTextColumn Header="Новая версия" Width="120" Binding="{Binding LastUpdate, StringFormat='{}{0:dd.MM.yyyy HH:mm}'}">

                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding State}" Value="Removed">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding State}" Value="Obsolete">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding State}" Value="New">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>

                                </DataGridTextColumn>

                                <DataGridTextColumn Header="Текущая версия" Width="120" Binding="{Binding CurrVersionTime, StringFormat='{}{0:dd.MM.yyyy HH:mm}'}">

                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding State}" Value="Removed">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding State}" Value="Obsolete">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding State}" Value="New">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>

                                </DataGridTextColumn>

                                <DataGridTextColumn Header="Состояние" Width="80" Binding="{Binding State}">

                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding State}" Value="Removed">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding State}" Value="Obsolete">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding State}" Value="New">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>

                                </DataGridTextColumn>

                            </DataGrid.Columns>
                        </DataGrid>

                        <Grid Grid.Row="2" Margin="0,5,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <Button Name="ButtonUpdate" 
                                    Content="Обновить" 
                                    Width="200" 
                                    Height="35" 
                                    HorizontalAlignment="Right"
                                    Click="ButtonUpdate_Click"/>
                        </Grid>
                    </Grid>
                </TabItem>

                <TabItem Name="TabCommits" Header="Коммиты" Width="140">
                    <Grid Margin="0,0,-5,-5">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Label Name="LabelCommits" 
                               Content="Коммиты с последнего обновления" 
                               HorizontalAlignment="Left" 
                               VerticalAlignment="Top" 
                               Margin="10,6,0,0" 
                               FontSize="12"/>

                        <DataGrid Name="CommitsDataGrid" 
                                  Grid.Row="1"
                                  AutoGenerateColumns="False" 
                                  CanUserAddRows="False"
                                  IsReadOnly="True"
                                  Margin="0,5,0,0"
                                  Style="{StaticResource DataGridStyle}">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Название" 
                                                    Width="*" 
                                                    Binding="{Binding Name}"/>
                                <DataGridTextColumn Header="Время" 
                                                    Width="150" 
                                                    Binding="{Binding Timestamp, StringFormat='{}{0:dd.MM.yyyy HH:mm}'}"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </TabItem>

                <TabItem Name="TabVersions" Header="Версии" Width="140">
                    <Grid Margin="0,0,-5,-5">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Label Name="LabelVers" 
                               Content="Хранилище предыдущих сборок" 
                               HorizontalAlignment="Left" 
                               VerticalAlignment="Top" 
                               Margin="10,6,0,0" 
                               FontSize="12"/>

                        <DataGrid Name="VersionsDataGrid" 
                                  Grid.Row="1"
                                  AutoGenerateColumns="False" 
                                  CanUserAddRows="False"
                                  IsReadOnly="True"
                                  Margin="0,5,0,0"
                                  Style="{StaticResource DataGridStyle}"
                                  SelectionMode="Single"
                                  SelectionUnit="FullRow"
                                  MouseRightButtonDown="VersionsDataGrid_MouseRightButtonDown">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Время" 
                            Width="120" 
                            Binding="{Binding VersionTime, StringFormat='{}{0:dd.MM.yyyy HH:mm}'}"/>
                                <DataGridTextColumn Header="Путь" 
                            Width="*" 
                            Binding="{Binding Path}"/>

                                <!-- Колонка "Открыть" с кнопкой -->
                                <DataGridTemplateColumn Header="Открыть" Width="100">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button Content="{Binding OpenButtonText}" 
                                                    Click="OpenButton_Click"
                                                    Tag="{Binding Path}"
                                                    HorizontalAlignment="Center"
                                                    Padding="5,2"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>

                                <!-- Колонка "Откатить" с кнопкой -->
                                <DataGridTemplateColumn Header="Откатить" Width="100">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button Content="{Binding RollbackButtonText}" 
                                                    Click="RollbackButton_Click"
                                                    Tag="{Binding Path}"
                                                    HorizontalAlignment="Center"
                                                    Padding="5,2"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </TabItem>
            </TabControl>
        </Grid>

        <!-- Нижняя область с логом -->
        <Grid Grid.Row="1" 
              Name="LogGrid" 
              Margin="5" 
              Background="#FF1F2126">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Заголовок лога -->
            <Grid Grid.Row="0">
                <Rectangle Name="NameAreaLog" 
                           Height="29" 
                           Stroke="#FFDFD3D3" 
                           VerticalAlignment="Top"
                           HorizontalAlignment="Stretch"
                           Margin="5,3,1,0"/>

                <Label Name="LabelLog" 
                       Content="Лог модуля" 
                       HorizontalAlignment="Left" 
                       VerticalAlignment="Top" 
                       Margin="10,6,0,0" 
                       FontSize="12"/>
            </Grid>

            <!-- DataGrid лога -->
            <DataGrid Name="LogsDataGrid" 
                      Grid.Row="1"
                      AutoGenerateColumns="False" 
                      CanUserAddRows="False"
                      IsReadOnly="True"
                      Margin="5,5,1,1"
                      Style="{StaticResource DataGridStyle}">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Время" 
                                        Width="150" 
                                        Binding="{Binding Time, StringFormat='{}{0:dd.MM.yyyy HH:mm}'}"/>

                    <DataGridTextColumn Header="Сообщение" 
                      Width="*" 
                      Binding="{Binding Message}">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="TextWrapping" Value="Wrap"/>
                                <Setter Property="VerticalAlignment" Value="Top"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>
    </Grid>
</Window>

